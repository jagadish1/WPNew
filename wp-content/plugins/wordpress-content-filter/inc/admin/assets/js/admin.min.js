!function(e){"use strict";e(document).ready(function(){var t={init:function(){this.build_sortable_draggable(),this.init_element_media(),this.init_color(),this.init_events(),this.init_settings_events()},build_sortable_draggable:function(){e(".wcf-forms-search-fields-list").sortable({handle:".menu-item-handle",connectWith:".wcf-forms-search-fields-list",revert:!0,placeholder:"sortable-placeholder",create:function(){},change:function(){},start:function(e,t){t.helper.width("100%"),t.helper.height("auto"),t.placeholder.width("100%"),t.placeholder.height(t.helper.outerHeight())},stop:function(i,n){var a=n.item;if(a.hasClass("ui-draggable")){a.addClass("wcf-loading"),a.removeClass("ui-draggable"),a.removeClass("wcf-icon-menu");var c=a.data("type"),f=e(".menu-item-settings",a);e.post(ajaxurl,{field_type:c,action:"wcf_field_settings_output",wcf_ajax_nonce:wcf_forms_variables.wcf_ajax_nonce},function(e){a.removeClass("wcf-loading"),f.prepend(e);f.find(".wcf-field-id").val();f.slideDown("fast",function(){a.find(".wcf-item-edit").addClass("open")}),t.init_item_events(a,f)})}}}).disableSelection(),e(".wcf-forms-available-field-list > li").draggable({connectToSortable:".wcf-forms-search-fields-list",helper:"clone",revert:"invalid",zIndex:100,create:function(){},drag:function(){},start:function(e,i){var n=i.helper,a=n.data("type");return"input_query"==a&&t.check_item(a)?(alert(wcf_forms_variables.input_query_exist),!1):"submit_button"==a&&t.check_item(a)?(alert(wcf_forms_variables.submit_button_exist),!1):"rating"==a&&t.check_item(a)?(alert(wcf_forms_variables.rating_exist),!1):void 0},stop:function(){}})},init_events:function(){e(".wcf-forms-search-fields-list li").each(function(){var i=e(this),n=e(".menu-item-settings",i);t.init_item_events(i,n)})},init_settings_events:function(){var t=e(".wcf_post_type_checkbox").first(),i=t.find('input[type="checkbox"]');e('input[name="wcf-settings[search_type]"]').on("change",function(){"single"==e(this).val()&&(i.attr("checked",!1),i.first().attr("checked",!0))}),i.on("click",function(){var n=e('input[name="wcf-settings[search_type]"]:checked'),a=t.find('input[type="checkbox"]:checked').length;if("single"==n.val())i.attr("checked",!1),e(this).attr("checked",!0);else if(1>a)return alert(wcf_forms_variables.at_least_one_post_type),!1})},init_item_events:function(i,n){var a=this,c=n.find(".wcf-field-id").val(),f=i.data("type"),l=e("#wcf-thickbox-body");if(n.find(".wcf-delete-field").on("click",function(i){i.preventDefault(),t.remove_field(e(this))}),n.find(".wcf-cancel-field").on("click",function(e){e.preventDefault(),n.slideUp("fast",function(){i.find(".wcf-item-edit").removeClass("open")})}),i.find(".wcf-item-edit").unbind().bind("click",function(t){t.preventDefault();var i=e(this);n.slideToggle("fast",function(){i.toggleClass("open")})}),"meta_field"==f)e("#wcf_forms_field_meta_key_"+c).on("change",function(){e.post(ajaxurl,{meta_key:e(this).val(),field_id:c,field_type:f,action:"wcf_generate_meta_key_options",wcf_ajax_nonce:wcf_forms_variables.wcf_ajax_nonce},function(t){e("#wcf_forms_field_options_"+c).val(t)})});else if("taxonomy"==f){var o=i.find("#wcf_forms_field_display_type_"+c),r=i.find("#wcf_forms_field_default_value_"+c),s=i.find("#wcf_forms_field_exclude_terms_"+c),_=i.find("#wcf_forms_field_taxonomy_"+c),d=e("#forms_field_wcf_forms_field_terms_color_"+c);_.on("change",function(){e.post(ajaxurl,{taxonomy:e(this).val(),field_id:c,field_type:f,field_name:"wcf_forms_field_terms_color_"+c,action:"wcf_terms_color",wcf_ajax_nonce:wcf_forms_variables.wcf_ajax_nonce},function(e){d.find(".wcf-form-field-wrapper, table").remove(),d.find(".wcf-field-label").after(e),a.init_color(d)})}),d.find(".wcf-generate-terms-color-button").on("click",function(e){e.preventDefault(),_.trigger("change")}),i.on("click",".wcf-exclude-terms-button",function(t){t.preventDefault(),l.html("Loading ...");var i=e(this).data("type");if(""==_.val())l.html(wcf_forms_variables.please_select_taxonomy);else{var n=!1;("select"==o.val()||"radio"==o.val())&&(n=!0),e.post(ajaxurl,{field_id:c,field_type:f,select_type:i,is_single:n,taxonomy:_.val(),action:"wcf_select_terms",wcf_ajax_nonce:wcf_forms_variables.wcf_ajax_nonce},function(t){l.html(t),e(".insert_term",l.parent()).unbind().bind("click",function(e){e.preventDefault();var t=l.find("#wcf-taxonomy-select").val();t.length>0&&(0==n&&"default"==i?(t=t.join("\n"),r.val(t)):"exclude"==i&&(t=t.join(","),s.val(t))),tb_remove()})})}})}},init_color:function(t){var i=e(".wcf-color-picker");null!=t&&(i=e(".wcf-color-picker",t)),i.each(function(){var t=e(this);t.wpColorPicker()})},init_element_media:function(){var t=this;e(".wcf-upload-image").on("click",function(i){i.preventDefault();var n=e(this),a=n.attr("data-field");t.upload_media(a,n.parent())})},upload_media:function(t,i){var n=wp.media({title:"Insert a media",library:{type:"image"},multiple:!1,button:{text:"Insert"}});return n.on("select",function(){var a=n.state().get("selection").first().toJSON();e("#"+t,i).val(a.url)}),n.open(),!1},remove_field:function(e){var t=e.closest(".wcf_forms_field_li");t.animate({opacity:0,height:0},350,function(){t.remove()})},check_item:function(t){return e('.wcf-forms-search-fields-list li[data-type="'+t+'"]').length?!0:!1}};t.init()})}(jQuery);