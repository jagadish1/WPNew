!function(a){"use strict";function t(t,e){this.$el=a(t),this.options=a.extend({scroll_top:"yes",ajax_loader:'<div class="wcf-ajax-loading"></div>',ajax_complete:function(){}},e),this.init()}t.prototype={init:function(){this.toggle_field(),this.form_search()},toggle_field:function(){a(".wcf-arrow-field .wcf-label").on("click",function(t){t.preventDefault();var e=a(this);e.parent().find(".wcf-field-body").slideToggle(300,function(){e.toggleClass("wcf-closed")})})},init_date:function(t){a(".range_date_wrapper",t).each(function(){var t=a(this),e=t.data("format-date"),n=a(".date_from",t),o=a(".date_to",t);n.length>0&&(n.datepicker({defaultDate:"+1w",changeMonth:!1,showOtherMonths:!0,dateFormat:e,onClose:function(a){o.datepicker("option","minDate",a)},showOn:"button",buttonText:'<span class="dashicons dashicons-calendar-alt"></span>',beforeShow:function(a,t){t.dpDiv.addClass("wcf-date-picker-skin")}}),o.datepicker({defaultDate:"+1w",changeMonth:!1,showOtherMonths:!0,dateFormat:e,onClose:function(a){n.datepicker("option","maxDate",a)},showOn:"button",buttonText:'<span class="dashicons dashicons-calendar-alt"></span>'}))})},init_range_slider:function(t,e){var n=this,o=a(".slider-range",t);o.length>0&&o.each(function(){var o=a(this),i=o.parent(),c=o.data("step"),s=a(".range_min",i),l=a(".range_max",i),r=a("span.range_from",i.parent()),f=a("span.range_to",i.parent()),d=s.data("min"),h=l.data("max"),p=parseInt(s.val()),u=parseInt(l.val());o.slider({range:!0,step:c,min:d,max:h,values:[p,u],slide:function(a,t){r.html(t.values[0]),f.html(t.values[1])},stop:function(a,o){s.val(o.values[0]),l.val(o.values[1]),n.form_submit(t,e)},change:function(){}})})},init_checkbox:function(t,e){var n=this;a(".wcf-checkbox-all",t).on("click",function(){var o=a(this),i=o.closest(".wcf-field-checkbox");o.is(":checked")?i.find(".wcf-checkbox-item").prop("checked",!0):i.find(".wcf-checkbox-item").prop("checked",!1),n.form_submit(t,e)}),a(".wcf-field-checkbox, .wcf-field-checkbox_color",t).each(function(){var o=a(this),i=a(".wcf-checkbox-all",o),c=a(".wcf-checkbox-item",o),s=c.length;i.on("click",function(){var o=a(this);o.is(":checked")?c.prop("checked",!0):c.prop("checked",!1),n.form_submit(t,e)}),c.on("click",function(){o.find(".wcf-checkbox-item:checked").length==s?i.prop("checked",!0):i.prop("checked",!1),n.form_submit(t,e)})})},form_search:function(){var t=this,e=this.$el,n=e.data("form"),o=a("#wcf-form-wrapper-"+n),i=o.length,c=e.data("auto"),s=window.location.pathname,l=e.data("ajax");if(i&&"ajax"==l){var r=o.data("loop"),f=o.data("columns");t.pagination_link(o,n,r,f)}"yes"==c&&a('input[type="text"], input[type="radio"], select, textarea',e).on("change",function(){e.submit()}),e.on("submit",function(c){if(0==i);else if("ajax"==l){c.preventDefault();var r=o.data("loop"),f=o.data("columns"),d=e.serialize();window.history.pushState("",document.title,s+"?"+d),o.append(t.options.ajax_loader),a.post(wcf_variables.ajax_url,{action:"wcf_search_ajax",wcf_ajax_nonce:wcf_variables.wcf_ajax_nonce,pathname:s,search:d,form_id:n,loop:r,result_columns:f},function(e){o.animate({opacity:0},500,function(){a(this).html(e).animate({opacity:1},500,function(){"yes"==t.options.scroll_top&&t.scroll_top(),t.pagination_link(o,n,r,f)})})})}else e.attr("action","")}),t.init_date(e),t.init_checkbox(e,c),t.init_range_slider(e,c)},ajax_call:function(a,t,e,n){a.trigger("wcf_form_search_ajax_done",[a,t,e,n])},form_submit:function(a,t){"yes"==t&&a.submit()},pagination_link:function(t,e,n,o){var i=this;a(".wcf-pagination a",t).unbind().bind("click",function(c){c.preventDefault();var s=a(this).data("page"),l=a(this).attr("href"),r=document.createElement("a");r.href=l,window.history.pushState("",document.title,r.pathname+r.search),t.append(i.options.ajax_loader);var f=window.location.pathname,d=window.location.search;""!=d&&"?"==d.substring(0,1)&&(d=d.replace("?","")),a.post(wcf_variables.ajax_url,{action:"wcf_search_ajax",wcf_ajax_nonce:wcf_variables.wcf_ajax_nonce,pathname:f,search:d,page_number:s,form_id:e,loop:n,result_columns:o},function(c){t.animate({opacity:0},500,function(){a(this).html(c).animate({opacity:1},500,function(){"yes"==i.options.scroll_top&&i.scroll_top(),i.pagination_link(t,e,n,o),i.ajax_call(t,e,n,o),a.isFunction(i.options.ajax_complete)&&i.options.ajax_complete.call(i)})})})})},scroll_top:function(){a("html, body").animate({scrollTop:0},200)}},a.fn.WCFilter=function(e){return this.each(function(){a.data(this,"plugin_wcfilter")||a.data(this,"plugin_wcfilter",new t(this,e))})},a(document).ready(function(){var t={scroll_top:wcf_variables.scroll_top};""!=wcf_variables.ajax_loader&&(t.ajax_loader='<div class="wcf-ajax-loading" style="background-image: url('+wcf_variables.ajax_loader+');"></div>');a(".wcf-form-search").WCFilter(t)})}(jQuery);